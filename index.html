<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encontre meu dono - Por Guti</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden-contact { display: none; }
        .found-stamp { transform: rotate(-15deg); border: 3px solid #16a34a; color: #16a34a; background: rgba(255,255,255,0.9); z-index: 40; }
        .adopted-stamp { transform: rotate(-15deg); border: 3px solid #facc15; color: #ca8a04; background: rgba(255,255,255,0.9); z-index: 40; }
        .preview-img { width: 100%; height: 100%; object-fit: cover; }
        .zoonoses-blur { backdrop-filter: blur(25px); background: rgba(0,0,0,0.95); border: 2px solid #ef4444; }
        .tab-btn { transition: all 0.3s; border-bottom: 4px solid transparent; }
        .tab-active { border-bottom: 4px solid #facc15; background: rgba(255,255,255,0.1); color: #facc15; }
        .btn-denuncia-active { border-bottom: 4px solid #ef4444 !important; color: #ef4444 !important; background: rgba(239, 68, 68, 0.1); }
        .admin-only { display: none; }
        .admin-mode .admin-only { display: block !important; }
    </style>
</head>
<body class="bg-gray-100 font-sans flex flex-col min-h-screen text-gray-900 transition-all">

    <header class="bg-blue-600 text-white shadow-2xl sticky top-0 z-50">
        <div class="p-4 text-center relative border-b border-blue-500">
            <h1 class="text-xl font-black uppercase italic leading-none tracking-tighter">Encontre meu dono</h1>
            <p class="text-[10px] font-light tracking-widest mt-1 opacity-80 uppercase font-bold text-blue-200">"Por Guti"</p>
            <button onclick="toggleGestor()" id="btnGestor" class="absolute top-2 right-2 opacity-20 hover:opacity-100 text-[10px]">üîí</button>
        </div>
        
        <nav class="flex w-full bg-blue-700 overflow-x-auto">
            <button onclick="mudarGuia('encontrados')" id="tab-encontrados" class="tab-btn flex-1 py-4 text-[9px] font-black uppercase tracking-tighter border-r border-blue-600 tab-active min-w-[80px]">Encontrados</button>
            <button onclick="mudarGuia('perdidos')" id="tab-perdidos" class="tab-btn flex-1 py-4 text-[9px] font-black uppercase tracking-tighter border-r border-blue-600 min-w-[80px]">Perdidos</button>
            <button onclick="mudarGuia('adocao')" id="tab-adocao" class="tab-btn flex-1 py-4 text-[9px] font-black uppercase tracking-tighter border-r border-blue-600 min-w-[80px] text-yellow-300">üêæ Me Adote</button>
            <button onclick="mudarGuia('denuncia')" id="tab-denuncia" class="tab-btn flex-1 py-4 text-[9px] font-black uppercase tracking-tighter text-red-400 min-w-[80px]">üö® Den√∫ncia</button>
        </nav>
    </header>

    <main class="container mx-auto p-4 flex-grow max-w-6xl">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <section class="lg:col-span-4">
                <div id="form-container" class="bg-white p-5 rounded-2xl shadow-lg border-t-4 border-blue-500 sticky top-28 max-h-[80vh] overflow-y-auto">
                    <h2 id="form-title" class="text-lg font-black mb-4 text-gray-800 uppercase italic">üì∏ Cadastrar Animal</h2>
                    
                    <form id="mainForm" class="space-y-4">
                        <input type="hidden" id="current_tab" value="encontrados">
                        
                        <div class="grid grid-cols-2 gap-2 text-[10px]">
                            <select id="bairro" class="p-3 border rounded-lg bg-gray-50 font-bold" required>
                                <option value="">Bairro em Mongagu√°...</option>
                                <option value="Agenor de Campos">Agenor de Campos</option>
                                <option value="Centro">Centro</option>
                                <option value="Ita√≥ca">Ita√≥ca</option>
                                <option value="Vera Cruz">Vera Cruz</option>
                                <option value="Jussara">Jussara</option>
                                <option value="Outros">Outros...</option>
                            </select>
                            
                            <select id="categoria" class="p-3 border rounded-lg font-black bg-gray-50 text-blue-600 border-blue-200">
                                <option value="normal">Situa√ß√£o Normal</option>
                                <option value="zoonoses">üö® ATROPELADO / FERIDO</option>
                            </select>
                        </div>

                        <div id="campos-adocao" class="hidden space-y-3 bg-blue-50 p-3 rounded-xl border border-blue-100">
                            <p class="text-[9px] font-black text-blue-700 uppercase">Detalhes para Ado√ß√£o:</p>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="text" id="adocao_idade" placeholder="Idade aprox." class="p-2 border rounded text-[10px]">
                                <select id="adocao_porte" class="p-2 border rounded text-[10px]">
                                    <option value="">Porte...</option>
                                    <option value="Pequeno">Pequeno</option>
                                    <option value="M√©dio">M√©dio</option>
                                    <option value="Grande">Grande</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-[9px] font-bold">
                                <label class="flex items-center gap-1"><input type="checkbox" id="adocao_crianca"> Aceita Crian√ßas</label>
                                <label class="flex items-center gap-1"><input type="checkbox" id="adocao_animais"> Aceita Pets</label>
                            </div>
                            <input type="text" id="adocao_ong" placeholder="Nome da ONG / Protetor" class="w-full p-2 border rounded text-[10px]">
                            <input type="text" id="adocao_endereco" placeholder="Endere√ßo para visita" class="w-full p-2 border rounded text-[10px]">
                        </div>

                        <textarea id="descricao" placeholder="Descreva os detalhes aqui..." class="w-full p-3 border rounded-lg text-xs h-20 shadow-sm" required></textarea>

                        <div id="contato-box" class="bg-yellow-50 p-3 rounded-xl border border-yellow-200">
                            <label class="block text-[9px] font-black text-yellow-700 uppercase mb-1">WhatsApp de Contato:</label>
                            <input type="tel" id="whatsapp_contato" placeholder="Ex: 13991753601" class="w-full p-2 border rounded-lg text-xs outline-none" required>
                        </div>

                        <div class="bg-gray-50 p-3 rounded-xl border border-dashed border-gray-300">
                            <label class="block text-[9px] font-black text-gray-500 uppercase mb-1">Fotos (At√© 3):</label>
                            <input type="file" id="input_foto" accept="image/*" multiple class="text-[10px] w-full">
                            <p id="msg-video" class="hidden text-[8px] text-red-500 mt-2 font-bold leading-tight italic">
                                * Apenas FOTO. V√≠deos ser√£o solicitados via WhatsApp por seguran√ßa.
                            </p>
                        </div>

                        <button type="button" onclick="obterLocalizacao()" id="btnLoc" class="w-full py-3 bg-gray-100 text-gray-700 rounded-lg text-[10px] font-black border hover:bg-gray-200">üìç MARCAR GPS</button>
                        <input type="hidden" id="coords" value="">

                        <button type="submit" id="btnSubmit" class="w-full bg-blue-600 text-white font-black py-4 rounded-xl shadow-xl uppercase text-xs tracking-widest">Publicar Agora</button>
                    </form>
                </div>
            </section>

            <section class="lg:col-span-8">
                <div id="admin-warning" class="hidden admin-only bg-red-600 p-3 rounded-lg mb-4 text-[10px] font-black text-white uppercase text-center shadow-lg">
                    üîí GEST√ÉO MONGBeach ATIVA
                </div>
                <div id="petFeed" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
            </section>
        </div>
    </main>

    <footer class="bg-gray-900 text-white p-8 mt-10 text-center border-t-4 border-yellow-400">
        <p class="text-[10px] opacity-60 uppercase font-black mb-1">MONGBeach Tecnologia ‚Ä¢ Projeto Guti 2026</p>
        <p class="text-xl font-black text-yellow-400 mt-2 tabular-nums">(13) 99175-3601</p>
    </footer>

    <script>
        const SENHA_GESTOR = "123Pin567Pin";
        let pets = JSON.parse(localStorage.getItem('pets_mongagua_v3')) || [];

        function mudarGuia(guia) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active', 'btn-denuncia-active'));
            const tab = document.getElementById(`tab-${guia}`);
            tab.classList.add('tab-active');
            
            document.getElementById('current_tab').value = guia;
            const camposAdocao = document.getElementById('campos-adocao');
            const msgVideo = document.getElementById('msg-video');
            const btnSubmit = document.getElementById('btnSubmit');

            camposAdocao.classList.toggle('hidden', guia !== 'adocao');
            msgVideo.classList.toggle('hidden', guia !== 'denuncia');

            if(guia === 'adocao') {
                btnSubmit.className = "w-full bg-yellow-500 text-black font-black py-4 rounded-xl shadow-xl uppercase text-xs";
            } else if(guia === 'denuncia') {
                tab.classList.add('btn-denuncia-active');
                btnSubmit.className = "w-full bg-red-600 text-white font-black py-4 rounded-xl shadow-xl uppercase text-xs";
            } else {
                btnSubmit.className = `w-full ${guia === 'perdidos' ? 'bg-green-600' : 'bg-blue-600'} text-white font-black py-4 rounded-xl shadow-xl uppercase text-xs`;
            }
            renderFeed();
        }

        function toggleGestor() {
            const isAdmin = document.body.classList.contains('admin-mode');
            if(isAdmin) {
                document.body.classList.remove('admin-mode');
                document.getElementById('btnGestor').innerText = "üîí";
                document.getElementById('admin-warning').classList.add('hidden');
            } else {
                if(prompt("Senha de Gestor:") === SENHA_GESTOR) {
                    document.body.classList.add('admin-mode');
                    document.getElementById('btnGestor').innerText = "üîì SAIR";
                    document.getElementById('admin-warning').classList.remove('hidden');
                }
            }
            renderFeed();
        }

        function obterLocalizacao() {
            navigator.geolocation.getCurrentPosition((pos) => {
                document.getElementById('coords').value = `${pos.coords.latitude},${pos.coords.longitude}`;
                document.getElementById('btnLoc').innerText = "‚úÖ GPS OK";
            });
        }

        document.getElementById('mainForm').onsubmit = function(e) {
            e.preventDefault();
            const files = document.getElementById('input_foto').files;
            let fotosCarregadas = [];
            
            if(files.length > 0) {
                Array.from(files).slice(0, 3).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => {
                        fotosCarregadas.push(reader.result);
                        if(fotosCarregadas.length === Math.min(files.length, 3)) salvarDado(fotosCarregadas);
                    };
                });
            } else {
                salvarDado([]);
            }
        };

        function salvarDado(fotos) {
            const novoItem = {
                id: Date.now(),
                guia: document.getElementById('current_tab').value,
                bairro: document.getElementById('bairro').value,
                categoria: document.getElementById('categoria').value,
                descricao: document.getElementById('descricao').value,
                whatsapp: document.getElementById('whatsapp_contato').value.replace(/\D/g, ''),
                coords: document.getElementById('coords').value,
                fotos: fotos,
                status: 'ativo',
                adocao: {
                    idade: document.getElementById('adocao_idade').value,
                    porte: document.getElementById('adocao_porte').value,
                    criancas: document.getElementById('adocao_crianca').checked,
                    animais: document.getElementById('adocao_animais').checked,
                    ong: document.getElementById('adocao_ong').value,
                    endereco: document.getElementById('adocao_endereco').value
                }
            };
            pets.unshift(novoItem);
            localStorage.setItem('pets_mongagua_v3', JSON.stringify(pets));
            renderFeed();
            document.getElementById('mainForm').reset();
            alert("Publicado com sucesso!");
        }

        function renderFeed() {
            const feed = document.getElementById('petFeed');
            const currentTab = document.getElementById('current_tab').value;
            const isAdmin = document.body.classList.contains('admin-mode');
            feed.innerHTML = '';

            pets.forEach(item => {
                if(item.guia === 'denuncia' && !isAdmin) return;
                if(!isAdmin && item.guia !== currentTab) return;

                const card = document.createElement('div');
                const isZoonoses = item.categoria === 'zoonoses';
                const isFinalizado = item.status === 'resolvido';
                
                card.className = `bg-white rounded-2xl shadow-lg border-b-4 overflow-hidden relative flex flex-col ${item.guia === 'denuncia' ? 'border-red-600' : (item.guia === 'adocao' ? 'border-yellow-400' : (item.guia === 'perdidos' ? 'border-green-500' : 'border-blue-500'))} ${isFinalizado ? 'opacity-40' : ''}`;
                
                card.innerHTML = `
                    <div class="h-32 bg-gray-200 relative overflow-hidden flex items-center justify-center">
                        ${item.fotos && item.fotos.length > 0 ? `<img src="${item.fotos[0]}" class="preview-img">` : '<span class="text-2xl font-black opacity-10 italic uppercase">MONGBeach</span>'}
                        
                        ${isZoonoses && !isFinalizado ? `<div class="absolute inset-0 z-30 zoonoses-blur flex flex-col items-center justify-center p-2 text-center text-white"><p class="text-[8px] font-black uppercase mb-1">‚ö†Ô∏è SENS√çVEL</p><button onclick="this.parentElement.remove()" class="bg-red-600 text-[7px] px-2 py-1 rounded-full uppercase">Exibir</button></div>` : ''}
                        
                        ${isFinalizado ? `
                            <div class="absolute inset-0 flex items-center justify-center z-40">
                                <span class="${item.guia === 'adocao' ? 'adopted-stamp' : 'found-stamp'} font-black px-2 py-1 uppercase text-[10px]">
                                    ${item.guia === 'adocao' ? 'ADOTADO!' : 'RESOLVIDO'}
                                </span>
                            </div>
                        ` : ''}

                        ${isAdmin ? `<button onclick="deletarItem(${item.id})" class="absolute top-1 right-1 bg-red-600 text-white rounded-full w-5 h-5 text-[10px] z-50">X</button>` : ''}
                    </div>
                    <div class="p-3 flex-grow flex flex-col">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-[7px] font-black px-1.5 py-0.5 rounded bg-gray-50 border uppercase tracking-tighter">${item.bairro}</span>
                            <span class="text-[7px] font-black text-gray-400 uppercase italic">${item.guia}</span>
                        </div>
                        <p class="font-bold text-gray-800 text-[10px] mt-1 h-8 overflow-hidden italic leading-none">"${item.descricao}"</p>
                        
                        ${item.guia === 'adocao' ? `
                            <div class="mt-2 text-[8px] bg-blue-50 p-2 rounded border border-blue-100 space-y-1">
                                <p><strong>Idade:</strong> ${item.adocao.idade || 'N/A'} | <strong>Porte:</strong> ${item.adocao.porte || 'N/A'}</p>
                                <p><strong>Conv√≠vio:</strong> ${item.adocao.criancas ? '‚úÖ Crian√ßas' : '‚ùå Crian√ßas'} | ${item.adocao.animais ? '‚úÖ Pets' : '‚ùå Pets'}</p>
                                <p class="truncate font-bold text-blue-800">${item.adocao.ong || 'Protetor'}</p>
                            </div>
                        ` : ''}

                        ${!isAdmin && !isFinalizado && item.guia !== 'denuncia' ? `
                            <button onclick="revelarContato(this, '${item.guia}')" class="w-full mt-3 py-2 rounded-lg bg-gray-900 text-white text-[9px] font-black uppercase shadow-md">${item.guia === 'adocao' ? 'Quero Adotar' : 'Ver Contato'}</button>
                            <div class="hidden-contact mt-3 text-center">
                                ${item.guia === 'adocao' ? '<p class="text-[6px] text-gray-400 font-bold mb-2 uppercase leading-none">* Autorizo o contato da ONG via LGPD.</p>' : ''}
                                <a href="https://wa.me/55${item.whatsapp}" target="_blank" class="text-green-600 font-black text-[10px] block underline uppercase tracking-tighter">WhatsApp</a>
                                <button onclick="marcarResolvido(${item.id})" class="text-[7px] text-gray-400 block w-full mt-2 underline uppercase">Finalizar Registro</button>
                            </div>
                        ` : (isFinalizado ? `<div class="mt-4 text-center text-green-600 font-black text-[9px] italic uppercase tracking-widest">${item.guia === 'adocao' ? 'Final Feliz! üè†' : 'Em Casa! üêæ'}</div>` : '')}
                        
                        ${isAdmin && item.guia === 'denuncia' ? `<div class="mt-2 p-2 bg-red-50 border border-red-200 rounded italic text-[8px]"><a href="https://wa.me/55${item.whatsapp}" target="_blank" class="text-red-600 font-bold underline">üì≤ CONTATAR DENUNCIANTE</a></div>` : ''}
                    </div>
                `;
                feed.appendChild(card);
            });
        }

        function revelarContato(btn, guia) {
            if(guia === 'adocao') {
                if(!confirm("Concorda em compartilhar seu n√∫mero com a ONG (LGPD) para entrevista?")) return;
            }
            btn.nextElementSibling.style.display = 'block';
            btn.style.display = 'none';
        }

        function marcarResolvido(id) { 
            const p = pets.find(x => x.id === id); 
            if(p) { p.status = 'resolvido'; localStorage.setItem('pets_mongagua_v3', JSON.stringify(pets)); renderFeed(); }
        }

        function deletarItem(id) { 
            if(confirm("Apagar permanentemente?")) { 
                pets = pets.filter(x => x.id !== id); 
                localStorage.setItem('pets_mongagua_v3', JSON.stringify(pets)); 
                renderFeed(); 
            } 
        }

        renderFeed();
    </script>
</body>
</html>
